# Task & Definition
- Task: TODO.md item 23 — Fix ESLint TS `no-undef` and Node 18 globals [ID: 2025-09-30.43].
- Definition of Done:
  - Disable core `no-undef` for TypeScript files via TS override so type-only identifiers do not get flagged.
  - Add Node 18 globals (`URL`, `AbortController`) to `languageOptions.globals`.
  - Keep `no-undef` enabled for JS files.
  - `pnpm -s lint > logs/latest-lint.log 2>&1` shows 0 error-level `no-undef` findings.

# Constraints/Risks
- Must not disable `no-undef` globally; JS should still be checked.
- Flat config overrides can replace `languageOptions`; ensure Node 18 globals remain effective across subsequent overrides.
- Large monorepo lint may take time; logs redirected per repo convention to avoid chat overflow.

# Code Searches
- Command: `sed -n '404,430p' TODO.md` — to confirm task 23 scope and acceptance.
- Command: `sed -n '1,520p' eslint.config.js` — to inspect TS and per-package overrides and existing globals/rules.
- Command: `rg -n "no-undef" logs/pre-task23-lint.log` — to verify baseline error count (expected ~24 as per TODO).

# Web Searches
- None (local repo configuration task; no external data needed).

# Implementation Notes
- Edited `eslint.config.js`:
  - In the TS-wide override (`files: ['**/*.ts', '**/*.tsx']`):
    - Added `rules: { 'no-undef': 'off' }`.
    - Extended `languageOptions.globals` with `URL: 'readonly'` and `AbortController: 'readonly'`.
  - Added a JS-only override to set Node 18 globals while keeping base `no-undef` active:
    - `files: ['**/*.js', '**/*.jsx']`, `languageOptions.globals` with `URL` and `AbortController`.
- Rationale: Avoid JS regressions while removing false positives for TS type names and Node 18 runtime globals in TS.

# Validation Evidence
- Baseline lint run (before changes):
  - Command: `pnpm -s lint > logs/pre-task23-lint.log 2>&1`
  - Observation: 24 `no-undef` errors (see `logs/pre-task23-lint.log`). Example entries include `URL`, `AbortController`, `ComponentValidation`, `RestoreResult`, `PostgresColumnDefinition`.
- Post-change lint run:
  - Command: `pnpm -s lint > logs/latest-lint.log 2>&1`
  - Result: `rg -n "no-undef" logs/latest-lint.log | wc -l` → 0.
  - Spot-check: No `no-undef` reported across backup-related files; `packages/backup/src/BackupService.ts` compiles under lint without `no-undef` (file is `@ts-nocheck`, but project-wide `no-undef` count is 0).

# Open Follow-ups
- None for this task. If JS code later relies on additional Node 18 globals (e.g., `TextEncoder`, `TextDecoder`, `queueMicrotask`), consider adding them to the JS override’s `globals`.
