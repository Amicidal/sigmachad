Task & Definition
- Task 9: Fix Parser Package RelationshipBuilder Interfaces [ID: 2025-09-29.9]
- Goal: Unify and complete builder option interfaces so parser and knowledge compile. Add missing fields and correct function signatures.

Constraints/Risks
- Monorepo depth and import rules; avoid deep relative paths.
- Types must align across @memento/shared-types and @memento/parser usage.
- Keep changes minimal, focused on types; no functional refactors unless required.

Code Searches
- rg: locate task 9 in TODO.md → found entry with scope and acceptance.
- rg: search for RelationshipBuilderOptions usage across packages to identify signature mismatches.
- Observed parser builders expect resolveImportedMemberToFileAndName(member, export, sf, importMap?, importSymbolMap?) returning { fileRel, name, depth }.

Web Searches
- None (offline/local task).

Implementation Notes
- Patched packages/shared-types/src/parsing-types.ts:
  - Base RelationshipBuilderOptions: add importSymbolMap param and return { fileRel, name, depth } | null.
  - Align TypeRelationshipBuilderOptions and ReferenceRelationshipBuilderOptions return types.
- Next: build @memento/parser and @memento/knowledge to validate.

Validation Evidence
- Will run: pnpm --filter @memento/parser build and pnpm --filter @memento/knowledge build
- Logs will be captured under logs/${SESSION_ID}-build-*.log

Open Follow-ups
- If additional fields are flagged by tsc (includeConfidence, etc.), extend types accordingly.
- Consider consolidating builder option interfaces per TODO note if overlap remains.

[2025-09-30 13:10 UTC]
Implementation Notes (cont.)
- Updated `packages/shared-types/src/parsing-types.ts`:
  - Base `RelationshipBuilderOptions`: added `importSymbolMap?: Map<string,string>` parameter and changed return type to `{ fileRel: string; name: string; depth: number } | null`.
  - Aligned `TypeRelationshipBuilderOptions` and `ReferenceRelationshipBuilderOptions` to the same return shape.
- Adjusted `packages/shared-types/tsconfig.json` to set `declarationDir: "./dist"` so declarations emit to `dist/*.d.ts` (was `dist/src/*`).

Validation Evidence
- Attempted incremental builds:
  - Built shared-types: logs/2025-09-30_1304-task9-build-shared-types.log (dist now contains `index.d.ts`).
  - Built core: logs/2025-09-30_1304-task9-build-core.log (success, no output).
  - Built graph: logs/2025-09-30_1304-task9-build-graph.log (blocked by downstream core/db TS6305; out of scope of Task 9).
  - Parser build: logs/2025-09-30_1304-task9-build-parser.log (blocked until graph builds; see above).
- Spot-checked parser builders use of `resolveImportedMemberToFileAndName(...)` with `importSymbolMap` and `{ fileRel, name, depth }` structure — matches updated types.

Open Follow-ups
- Run full workspace build in proper order once TS project reference consistency holds (tracked by existing Task 2025-09-30.10 and related follow-ups).
- After graph builds cleanly, re-run: `pnpm --filter @memento/parser build` and `pnpm --filter @memento/knowledge build` to complete Task 9 acceptance.
[2025-09-30 13:15 UTC]
Validation Evidence (cont.)
- Built in order to satisfy TS project references:
  - graph (forced re-emit of declarations): logs/2025-09-30_1304-task9-build-graph.log
  - parser: logs/2025-09-30_1304-task9-build-parser.log
  - knowledge: logs/2025-09-30_1304-task9-build-knowledge.log
- Assertions verified:
  - Parser compiles without TS6305/TS2345.
  - Knowledge compiles cleanly; RelationshipBuilder.ts no longer mismatches builder option types.
