Task & Definition

Constraints/Risks

Code Searches

Web Searches

Implementation Notes

Validation Evidence

Open Follow-ups

---
Task & Definition
- Time: 2025-09-30 20:02:06 UTC
- Task: TODO.md item 17 — Import boundaries and path-alias compliance [ID: 2025-09-30.37]. Bring repo into compliance with monorepo rules by eliminating deep relative imports and cross-package type-only imports outside @memento/shared-types.

Constraints/Risks
- Must avoid introducing downstream/circular deps while switching imports.
- Lint output is large; capture to logs per convention.
- Structure check script failed to bind IPC in sandbox (EPERM); verify locally if needed.

Code Searches
- Ran: pnpm -s lint > logs/latest-lint.log 2>&1 — to gather violations.
- Searched deep relatives: rg -n --pcre2 "(\.\./){3,}" packages — none found.
- Found cross-package type-only imports via log + grep:
  - packages/database/src/postgres/PostgreSQLService.ts (from @memento/core/types/types)
  - packages/database/src/DatabaseService.ts (from @memento/core/types/types)
  - packages/sync/src/scm/SCMService.ts (from @memento/graph)
  - packages/api/src/mcp-router.ts (from @memento/core)
  - packages/api/src/routes/scm.ts (from @memento/core)
  - packages/api/src/routes/admin.ts (types from @memento/knowledge, @memento/database, @memento/core)
  - packages/jobs/src/TemporalHistoryValidator.ts (from @memento/core)
  - packages/jobs/src/(persistence/)PostgresSessionCheckpointJobStore.ts (from @memento/database)
  - packages/knowledge/src/ingestion-workers/task-worker.ts (from @memento/utils)
  - packages/testing/src/TestPlanningService.ts + SpecService.ts (from @memento/core)
  - packages/graph/src/services/structuralPersistence.ts and src/structuralPersistence.ts (from @memento/core)

Web Searches
- None.

Implementation Notes
- Switched all type-only imports above to @memento/shared-types where types exist.
- For admin route, replaced cross-package class typing with shared interfaces: use IDatabaseService/IKnowledgeGraphService; kept core value imports for classes used at runtime.
- Tests: removed cross-package type-only imports in mock factories by loosening overrides typing to Record<string, any> (tests allow any).
- Graph structuralPersistence files: moved GraphRelationship/StructuralImportType/RelationshipType to @memento/shared-types.
- Knowledge worker: moved WorkerTaskMessage/WorkerTaskResult to @memento/shared-types.
- Files patched: 
  - packages/database/src/DatabaseService.ts
  - packages/database/src/postgres/PostgreSQLService.ts
  - packages/jobs/src/TemporalHistoryValidator.ts
  - packages/jobs/src/PostgresSessionCheckpointJobStore.ts
  - packages/jobs/src/persistence/PostgresSessionCheckpointJobStore.ts
  - packages/sync/src/scm/SCMService.ts
  - packages/api/src/mcp-router.ts
  - packages/api/src/routes/scm.ts
  - packages/api/src/routes/admin.ts
  - packages/api/tests/mock-factories.ts
  - packages/testing/src/TestPlanningService.ts
  - packages/testing/src/SpecService.ts
  - packages/knowledge/src/ingestion-workers/task-worker.ts
  - packages/graph/src/services/structuralPersistence.ts
  - packages/graph/src/structuralPersistence.ts
- Updated TODO.md: task 17 status → Complete.

Validation Evidence
- Ran: pnpm -s lint > logs/latest-lint.log 2>&1
  • Grep check: rg -n "custom/no-cross-package-type-imports|no-restricted-imports" logs/latest-lint.log → no matches.
- Ran: pnpm -s tsx scripts/check-service-structure.ts > logs/latest-structure.log 2>&1
  • Result: failed to bind IPC pipe (EPERM) in sandbox; see logs/latest-structure.log for stack. Recommend running locally.

Open Follow-ups
- Optionally switch remaining core value imports of RelationshipType, Entity, etc. in graph/api to @memento/shared-types for consistency (not required for this task).
- Consider adding minimal interfaces for FileWatcher/LoggingService/MaintenanceService/ConfigurationService to @memento/shared-types and migrate admin route typing.
- Re-run scripts/check-service-structure.ts outside sandbox to confirm structural compliance.
