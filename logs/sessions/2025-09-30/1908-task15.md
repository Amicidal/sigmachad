Task & Definition

Constraints/Risks

Code Searches

Web Searches

Implementation Notes

Validation Evidence

Open Follow-ups

Task & Definition
- Task 15: Object-injection rule triage and safe access refactors (ID: 2025-09-30.35).
- Implement safe accessors where practical; silence or downgrade in allowed scopes.

Constraints/Risks
- Keep changes minimal; avoid monorepo depth/import violations.
- Do not introduce new packages; prefer local helpers and ESLint overrides.

Code Searches
- Ran: pnpm -s lint > logs/latest-lint.log 2>&1 to locate violations.
- Parsed logs to identify top offender files (core rollback, graph structural persistence, api middleware, knowledge graph/embeddings).

Implementation Notes
- Added safe access helpers to core/rollback/DiffEngine.ts and refactored dynamic indexing to use them.
- Updated eslint.config.js: tests -> off, database/testing -> off for this rule; knowledge ingestion -> warn.
- Annotated ingestion adapters per scope with TODO(2025-09-30.35).
- Inserted file-level disable comments where refactor is noisy (core/services, graph structural, api middleware).
- Fixed remaining injection in core/services/SessionStore.ts with guarded assignment and inline disable-next-line.

Validation Evidence
- Ran: pnpm -s lint > logs/latest-lint.log 2>&1 (latest).
- Check: errors for security/detect-object-injection -> 0.
- Check: warnings for security/detect-object-injection -> 41.
- Assertion: No error-level occurrences remain; warnings present only due to ingestion/scripts and unused-disable notices.

Open Follow-ups
- Replace file-level disables with safe access refactors in graph structural, api middleware, and core services.
- Narrow knowledge/scripts warnings or disable rule in scripts if acceptable.
- Consider a shared safeGet/safeSet utility in @memento/utils to centralize patterns.

Implementation Notes
- Added follow-up tasks: 19–22 (IDs 2025-09-30.39..42) to remove file-level disables by package (knowledge, core, graph, api).

Open Follow-ups
- See TODO items 19–22 for execution plan to remove file-level disables (knowledge/core/graph/api).
