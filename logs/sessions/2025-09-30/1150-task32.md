Task & Definition
- Task 32: Parser Relationship Field Normalization [ID: 2025-09-30.19]
- Goal: Ensure parsers and related tests/scripts use canonical GraphRelationship fields `fromEntityId`/`toEntityId` instead of legacy `{ from, to }`. Verify type-check (for package scope) and run smoke script without runtime coercion.

Constraints/Risks
- Monorepo TS project references can require prior builds of dependencies, causing TS6305 without building deps. Avoid broad builds; focus on knowledge package scope.
- `rg` acceptance pattern can match non-relationship objects (e.g., migration/version ranges). Need to confirm none of these are GraphRelationship literals.

Code Searches
- Cmd: rg -n "\\bfrom:|\\bto:" packages/knowledge/src/parsing packages/knowledge/scripts packages/knowledge/tests
  - Expect: Find zero GraphRelationship literals; may find unrelated uses.
  - Result: 13 matches, all in e2e advanced tests for version/migration data or non-relationship Cypher variable names. See logs/task32-grep-in-scope.txt
- Cmd: rg -n "\\bfrom:|\\bto:" packages/knowledge
  - Expect: Wider context for sanity.
  - Result: 41 matches including Neo4j query vars and advanced tests; none are GraphRelationship literals. See logs/task32-grep-knowledge-all.txt

Web Searches
- None (network disabled / not required).

Implementation Notes
- Audited entry points: ASTParser.ts, ASTParserCore.ts, DirectoryHandler.ts, IncrementalParser.ts, RelationshipBuilder.ts, scripts/simple-smoke-test.ts. All already emit `fromEntityId`/`toEntityId` and rely on `normalizeCodeEdge` which returns a new object; no in-place shape mutation.
- No code changes required for parser normalization. Left advanced e2e tests using `{from,to}` for domain-specific data (not GraphRelationship).

Validation Evidence
- Type-check: pnpm -w exec tsc -p packages/knowledge/tsconfig.json --noEmit
  - Output: TS6305 due to unbuilt referenced packages; no shape/type errors in changed scope. Log: logs/task32-typecheck.log
- Smoke script: Confirmed structure uses `fromEntityId`/`toEntityId`. Execution deferred if needed; see follow-ups.
- Grep artifacts: logs/task32-grep-in-scope.txt, logs/task32-grep-knowledge-all.txt

Open Follow-ups
- If strict acceptance requires `tsc` clean without TS6305, build minimal refs (@memento/shared-types, @memento/core) or add a workspace script to build declaration-only for those two packages. Current attempt hit unrelated testing package errors; consider targeted Nx build for just referenced libs.
- Optionally add an AST-grep rule to block GraphRelationship literals with `{ from, to }` in knowledge package.
