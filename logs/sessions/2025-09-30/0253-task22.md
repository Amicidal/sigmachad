Task & Definition
Implement Task 22: Consolidate Ambient Type Augmentations [ID: 2025-09-30.9]. Goal: remove file-level triple-slash reference in `packages/api/src/APIGateway.ts` and ensure Fastify request augmentation is applied via TypeScript configuration so the workspace type-check picks it up without inline comments.

Constraints/Risks
- Monorepo tsconfig layering: packages extend `tsconfig.base.json`; tests extend `tsconfig.json`. Changes must not break other packages.
- Avoid scanning all `@types` via `typeRoots` to prevent stub packages (e.g., `@types/chokidar`) from causing TS2688.
- Keep path depth ≤3 and avoid cross-package coupling; prefer package-local inclusion over root-wide hacks.

Code Searches
- `rg -n "APIGateway\.ts|fastify\.d\.ts|<reference" packages/api -S` — located triple-slash in `packages/api/src/APIGateway.ts:1` and ambient file path.
- `rg -n "^### +22\." TODO.md` — found Task 22 block at TODO.md:427 with scope/acceptance.
- `rg -n "<reference types=\"chokidar\""` — none found (investigated TS2688 cause).

Web Searches
- None. Used local codebase and TypeScript behavior knowledge.

Implementation Notes
- Initial attempt: add workspace `typeRoots` (./types, ./node_modules/@types) and move augmentation to `types/fastify/index.d.ts`. Reverted after TS2688 due to `@types/chokidar` being a stub without `index.d.ts`.
- Final approach:
  - Restored package-local ambient file at `packages/api/src/types/fastify.d.ts` (declare module 'fastify' with `FastifyRequest.auth?: AuthContext`).
  - Removed file-level triple-slash from `packages/api/src/APIGateway.ts`.
  - Added explicit inclusion via `files` array in `packages/api/tsconfig.json`: `["src/types/fastify.d.ts"]` to ensure augmentation is loaded by the project without inline references.
  - Left `tsconfig.base.json` and `tsconfig.json` typeRoots unchanged to avoid repo-wide side-effects.

Validation Evidence
- Config inclusion verified: `logs/tsconfig-api-showconfig-task22.json` shows `"files": ["./src/types/fastify.d.ts"]` in the resolved API tsconfig (`pnpm -w tsc -p packages/api/tsconfig.json --showConfig`).
- Inline reference removed: `logs/verify-task22-no-reference.log` empty output confirms no `/// <reference path="./types/fastify.d.ts" />` remains in `packages/api/src/APIGateway.ts`.
- Full API typecheck attempted: `logs/latest-typecheck-api-task22.log` contains unrelated workspace type errors (testing and cross-package rootDir constraints) but demonstrates the ambient file is now configured via tsconfig, not inline.

Open Follow-ups
- Optional: adopt a small `types/memento/index.d.ts` plus selective `compilerOptions.types` per tsconfig if we later want a single place for additional ambient augments (e.g., Vitest globals). For now, package-local inclusion meets scope without introducing `typeRoots` issues.
