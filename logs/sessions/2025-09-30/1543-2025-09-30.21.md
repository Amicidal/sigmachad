Task & Definition
- Task: Resolve type errors in @memento/api [ID: 2025-09-30.21]
- Goal: Make `pnpm nx build api --skip-nx-cache` pass with no TS errors by aligning types or decoupling `@memento/api` from broken deps. Secondary: ensure `SessionCheckpointJob` type usage aligns with `SessionCheckpointJobSnapshot`.

Constraints/Risks
- Must prioritize velocity; avoid legacy shims. Prefer refactors that reduce build coupling.
- `api` currently imports `@memento/testing` directly; testing package has type errors blocking `api` build.
- Network restricted; canâ€™t fetch external info. pnpm available.
- Concurrency risk: other agents may modify files; keep diffs focused.

Code Searches
- Command: `rg -n "SessionCheckpointJob" -S`
  - Expect: Locate file referenced by TODO entry points.
  - Result: File lives at `packages/jobs/src/SessionCheckpointJob.ts` (not `packages/api`). Lines ~564/578/595 map to `job.id` logging and snapshot mapping where `lastError` is read/written.
- Command: `rg -n "@memento/testing" -S packages/api`
  - Expect: Find compile-time imports coupling `api` to testing.
  - Result: Imports in `src/mcp-router.ts`, `src/APIGateway.ts`, `src/routes/{tests.ts,security.ts,design.ts}`, plus dynamic pattern already applied in `routes/trpc-design.ts`.

Web Searches
- None (network restricted, and repository contains needed context).

Implementation Notes
- Strategy: Remove compile-time imports of `@memento/testing` from `api` and use lazy `createRequire(import.meta.url)` to instantiate classes at runtime. Define minimal local interfaces where useful; otherwise type as `any` to unblock build.
- Targets to update: `APIGateway.ts`, `mcp-router.ts`, `routes/tests.ts`, `routes/security.ts`, `routes/design.ts`.
- Observed that `SessionCheckpointJobSnapshot` already includes `status`, `lastError`, `queuedAt`, `updatedAt`; current `InternalSessionCheckpointJob` in `packages/jobs` extends snapshot, so properties exist. The errors cited in TODO likely predated this shape; main current blocker is `@memento/testing` type errors cascading into `api` build.

Validation Evidence
- Command: `pnpm nx build api --skip-nx-cache > logs/latest-build-api.log 2>&1`
  - Excerpt: Type errors in `packages/testing/src/temporal/*` (TS2339/TS2551/etc.), preventing `api` from building due to direct imports.
  - Log: `logs/latest-build-api.log` (see tail excerpt in chat).

Open Follow-ups
- After decoupling and passing build, run again to confirm no TS errors in `jobs` package leak into `api`.
- If necessary, add targeted unit tests for `SessionCheckpointJobRunner` state transitions (may live under `tests/unit/jobs/`).
- Consider documenting the lazy-load pattern (mirroring `routes/trpc-design.ts`) in `Docs/` to standardize across routes.


[1556 UTC] Validation Update
- Ran: pnpm nx build api --skip-nx-cache
- Result: SUCCESS (no TS errors)
- Log: logs/latest-build-api.log (checked tail and exit code)
